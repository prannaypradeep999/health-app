generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum HealthGoal {
  WEIGHT_LOSS
  MUSCLE_GAIN
  ENDURANCE
  GENERAL_WELLNESS
}

model User {
  id              String           @id @default(cuid())
  email           String           @unique
  password        String           // bcrypt hashed password
  firstName       String
  lastName        String
  createdAt       DateTime         @default(now())
  updatedAt       DateTime         @updatedAt
  
  // Relations
  surveys         SurveyResponse[]
  activeSurveyId  String?          @unique
  activeSurvey    SurveyResponse?  @relation("ActiveSurvey", fields: [activeSurveyId], references: [id])
}

model SurveyResponse {
  id              String     @id @default(cuid())
  
  // User connection (null for guests)
  userId          String?
  user            User?      @relation(fields: [userId], references: [id])
  activeForUser   User?      @relation("ActiveSurvey")
  
  // All survey data (stored for both guests and users)
  email           String
  firstName       String
  lastName        String
  age             Int
  sex             String
  height          String
  weight          Int
  zipCode         String
  goal            HealthGoal
  activityLevel   String
  budgetTier      String
  dietPrefs       String[]
  mealsOutPerWeek Int
  biomarkerJson   Json?
  source          String     @default("web")
  
  // Guest tracking
  isGuest         Boolean    @default(true)
  sessionId       String?    // For linking guest to browser session
  
  createdAt       DateTime   @default(now())
  updatedAt       DateTime   @updatedAt

  @@index([userId])
  @@index([sessionId])
  @@index([email])
}